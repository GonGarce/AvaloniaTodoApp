<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:dialogHostAvalonia="clr-namespace:DialogHostAvalonia;assembly=DialogHost.Avalonia"
        x:Class="AvaloniaTodoApp.Views.MainWindow"
        xmlns:lang="clr-namespace:AvaloniaTodoApp.Lang"
        xmlns:vm="clr-namespace:AvaloniaTodoApp.ViewModels"
        xmlns:controls1="clr-namespace:AvaloniaTodoApp.Controls"
        xmlns:collections="clr-namespace:AvaloniaTodoApp.ViewModels.Collections"
        xmlns:collections1="clr-namespace:AvaloniaTodoApp.Views.Collections"
        mc:Ignorable="d" d:DesignWidth="600" d:DesignHeight="450"
        MinWidth="720" MinHeight="480"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/avalonia-logo.ico"
        Title="AvaloniaTodoAPp">

    <Design.DataContext>
        <vm:MainWindowViewModel>
            <vm:MainWindowViewModel.CollectionsTabViewModel>
                <collections:CollectionsTabViewModel>
                    <collections:CollectionsTabViewModel.Tabs>
                        <collections:CollectionItemViewModel Hidden="False" Title="List 1" />
                        <collections:CollectionItemViewModel Hidden="False" Title="List 2" />
                        <collections:CollectionItemViewModel Hidden="False" Title="List 3" />
                    </collections:CollectionsTabViewModel.Tabs>
                </collections:CollectionsTabViewModel>
            </vm:MainWindowViewModel.CollectionsTabViewModel>
        </vm:MainWindowViewModel>
    </Design.DataContext>

    <dialogHostAvalonia:DialogHost
        Identifier="CollectionsDialogHost"
        DialogMargin="0"
        dialogHostAvalonia:DialogHostStyle.CornerRadius="8"
        DisableOpeningAnimation="True"
        BlurBackground="False">

        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="280"></ColumnDefinition>
                <ColumnDefinition Width="*"></ColumnDefinition>
            </Grid.ColumnDefinitions>
            <collections1:CollectionsTabView Grid.Column="0" DataContext="{Binding CollectionsTabViewModel}" />
            <DockPanel Grid.Column="1">
                <Grid DockPanel.Dock="Top" Margin="18 8 16 0" ColumnDefinitions="Auto,*" Height="32">
                    <TextBlock
                        Grid.Column="0" FontSize="16" FontWeight="Bold" VerticalAlignment="Center"
                        Text="{Binding Tasks, Converter={StaticResource CollectionCount}, StringFormat={x:Static lang:Resources.Tasks}}" />
                    <HyperlinkButton Grid.Column="1" Padding="2" HorizontalAlignment="Right" VerticalAlignment="Center"
                                     IsVisible="{Binding Avatars, Converter={StaticResource SmallerCount}, ConverterParameter=2}">
                        <StackPanel Orientation="Horizontal">
                            <PathIcon Data="{StaticResource LockRegular}" Height="14" Width="18" />
                            <TextBlock
                                Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"
                                FontSize="14" Text="{x:Static lang:Resources.PrivateList}" />
                        </StackPanel>
                    </HyperlinkButton>
                    <controls1:AvatarList
                        Grid.Column="1"
                        IsVisible="{Binding Avatars, Converter={StaticResource GreaterCount}, ConverterParameter=1}"
                        HorizontalAlignment="Right"
                        Flow="RightLeft"
                        Size="32"
                        Avatars="{Binding Avatars}" />
                </Grid>
                <TextBox DockPanel.Dock="Top"
                         Name="NewTaskInput"
                         Watermark="{Binding Watermark}"
                         Margin="18 6 18 6" Padding="8"
                         Text="{Binding NewTaskText}">
                    <TextBox.InnerLeftContent>
                        <Button Name="SearchButton" HotKey="Ctrl+K" IsVisible="False" />
                    </TextBox.InnerLeftContent>
                    <TextBox.InnerRightContent>
                        <Button Classes="icon primary" HorizontalAlignment="Right" VerticalAlignment="Center"
                                IsDefault="True" Command="{Binding AddTaskCommand}">
                            <PathIcon Data="{StaticResource AddSquareRegular}" />
                        </Button>
                    </TextBox.InnerRightContent>
                </TextBox>
                <DockPanel DockPanel.Dock="Top" Margin="20 0">
                    <StackPanel DockPanel.Dock="Left" Orientation="Horizontal">
                        <TabControl SelectedIndex="{Binding SelectedTab}" IsVisible="{Binding ShowTabs}">
                            <TabItem Header="{DynamicResource TabAll}" />
                            <TabItem Header="{DynamicResource TabTodo}" />
                            <TabItem Header="{DynamicResource TabCritical}" />
                        </TabControl>
                    </StackPanel>
                    <StackPanel HorizontalAlignment="Right" Orientation="Horizontal" Margin="0 6">
                        <Button Classes="icon primary"
                                Command="{Binding UndoCommand}"
                                HotKey="Ctrl+Z">
                            <PathIcon Data="{StaticResource ArrowUndoRegular}" />
                        </Button>
                        <Button Classes="icon primary" ToolTip.Tip="{DynamicResource TipRemoveCompleted}"
                                Command="{Binding ClearTasksCommand}">
                            <PathIcon Data="{StaticResource TextCollapseRegular}" />
                        </Button>
                        <Button Classes="icon" HorizontalAlignment="Center">
                            <PathIcon Data="{StaticResource OptionsRegular}" />
                            <Button.Flyout>
                                <MenuFlyout>
                                    <MenuItem Classes.active="{Binding SortRecentFirst}" Header="Recent first"
                                              Command="{Binding SortTasksCommand}"
                                              CommandParameter="{StaticResource True}">
                                        <MenuItem.Icon>
                                            <PathIcon Data="{StaticResource ArrowUpRegular}" />
                                        </MenuItem.Icon>
                                    </MenuItem>
                                    <MenuItem Classes.active="{Binding !SortRecentFirst}" Header="Recent last"
                                              Command="{Binding SortTasksCommand}"
                                              CommandParameter="{StaticResource False}">
                                        <MenuItem.Icon>
                                            <PathIcon Data="{StaticResource ArrowDownRegular}" />
                                        </MenuItem.Icon>
                                    </MenuItem>
                                </MenuFlyout>
                            </Button.Flyout>
                        </Button>
                    </StackPanel>
                </DockPanel>

                <ScrollViewer>
                    <ItemsControl Background="Transparent"
                                  Margin="20 0"
                                  ItemsSource="{Binding ShowedTasks, FallbackValue='Loading your tasks...'}" />
                </ScrollViewer>
            </DockPanel>
        </Grid>
    </dialogHostAvalonia:DialogHost>
</Window>